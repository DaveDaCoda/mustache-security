#summary KnockoutJS template security and XSS

<wiki:toc max_depth="2" />

= Introduction =

"Knockout is a standalone JavaScript implementation of the Model-View-ViewModel pattern with templates. The underlying principles are therefore:

 * a clear separation between domain data, view components and data to be displayed
 * the presence of a clearly defined layer of specialized code to manage the relationships between the view components

The latter leverages the native event management features of the Javascript language.

These features streamline and simplify the specification of complex relationships between view components, which in turn make the display more responsive and the user experience richer.

Knockout was developed and is maintained by Steve Sanderson, a Microsoft employee. The author stresses that this is a personal open-source project, and not a Microsoft product"

From http://en.wikipedia.org/wiki/KnockoutJS

= Quick Facts =

 * [http://knockoutjs.com/downloads/knockout-2.3.0.debug.js KnockoutJS 2.3.0 (Uncompressed)]
 * Usage Stats http://trends.builtwith.com/javascript/KnockoutJS

= Injection Attacks =

KnockoutJS is attackers best friend since it allows to execute arbitrary JavaScript by injecting into HTML5 data attributes. Any labelled JavaScript code that is being found inside a `data-bind` attribute will be evaluated once the bindings are being applied by KnockoutJS.

The following "paste-and-go"-ready code example demonstrates that. 

{{{
<script src="http://knockoutjs.com/downloads/knockout-2.3.0.js"></script>
<div data-bind="x:alert(1)" />
<script> 
	ko.applyBindings();
</script>
}}}

== Eval via Function ==

As can be seen, very much like CanJS, KnockoutJS uses a string containing a `with()` block to wrap the template data and then send it to the `Function` constructor for direct string-to-code.

{{{
parseBindingsString: function(b, c, d) {
    try {
        var f;
        if (!(f = this.Na[b])) {
            var g = this.Na, e, m = "with($context){with($data||{}){return{" + a.g.ea(b) + "}}}";
            e = new Function("$context", "$element", m);
            f = g[b] = e
        }
        return f(c, d)
    } catch (h) {
        throw h.message = "Unable to parse bindings.\nBindings value: " + b + "\nMessage: " + h.message, h;
    }
}
}}}