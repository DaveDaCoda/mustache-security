#summary Underscore.js security, injections and XSS

<wiki:toc max_depth="2" />

= Introduction =

Add your content here.

= Quick Facts =

 * [http://underscorejs.org/underscore.js Underscore.js 1.5.1 (Uncompressed)]

= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages

{{{
<script type='text/javascript' src='http://code.jquery.com/jquery-git.js'></script>
<script type='text/javascript' src="http://documentcloud.github.com/underscore/underscore-min.js"></script>

<script type='text/javascript'>
$(window).load(function(){
	
_.template($(x).html(), {});
_.template('<% alert(3) %>', {});
	
});
</script>

<script type="text/html" id='x'>
    <% alert(1) %>
    <%= _.constructor.constructor("alert(2)")() %>
</script>
}}}

== Eval via Function ==

{{{
j.template = function(n, t, r) {
        var e;
        r = j.defaults({}, r, j.templateSettings);
        var u = new RegExp([(r.escape || q).source, (r.interpolate || q).source, (r.evaluate || q).source].join("|") + "|$", "g"), i = 0, a = "__p+='";
        n.replace(u, function(t, r, e, u, o) {
            return a += n.slice(i, o).replace(z, function(n) {
                return "\\" + B[n]
            }), r && (a += "'+\n((__t=(" + r + "))==null?'':_.escape(__t))+\n'"), e && (a += "'+\n((__t=(" + e + "))==null?'':__t)+\n'"), u && (a += "';\n" + u + "\n__p+='"), i = o + t.length, t
        }), a += "';\n", r.variable || (a = "with(obj||{}){\n" + a + "}\n"), a = "var __t,__p='',__j=Array.prototype.join," + "print=function(){__p+=__j.call(arguments,'');};\n" + a + "return __p;\n";
        try {
            e = new Function(r.variable || "obj", "_", a)
        } catch (o) {
            throw o.source = a, o
        }
        if (t)
            return e(t, j);
        var c = function(n) {
            return e.call(this, n, j)
        };
        return c.source = "function(" + (r.variable || "obj") + "){\n" + a + "}", c
    }
}}}